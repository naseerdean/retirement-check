<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Structured Retirement Income</title>

<style>
body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;
background:linear-gradient(135deg,#0c1626,#1b2a44);
color:white;
padding:40px 20px;
}

h1{
font-family:Georgia,serif;
font-size:38px;
margin-bottom:10px;
}

.subtitle{
color:#cfd8e3;
margin-bottom:40px;
}

.card{
background:rgba(255,255,255,0.08);
padding:28px;
border-radius:20px;
backdrop-filter:blur(14px);
margin-bottom:30px;
box-shadow:0 10px 40px rgba(0,0,0,0.4);
}

button{
background:#d4af37;
color:#0c1626;
padding:14px 26px;
border:none;
border-radius:14px;
font-weight:bold;
font-size:16px;
margin-top:15px;
cursor:pointer;
transition:0.3s;
}

button:hover{
transform:scale(1.05);
}

button.secondary{
background:#2b3c58;
color:white;
margin-left:10px;
}

input, textarea{
width:100%;
padding:14px;
margin-top:8px;
margin-bottom:18px;
border-radius:12px;
border:none;
font-size:16px;
}

.hidden{display:none;}

.result-box{
padding:20px;
border-radius:16px;
margin-top:20px;
line-height:1.6;
animation:fadeIn 1s ease-in;
}

@keyframes fadeIn{
from{opacity:0; transform:translateY(10px);}
to{opacity:1; transform:translateY(0);}
}

.red{background:#5a2a2a;}
.orange{background:#5a4b2a;}
.green{background:#2a5a3a;}

canvas{
background:white;
border-radius:14px;
margin-top:20px;
}

.small{
font-size:12px;
color:#cfd8e3;
margin-top:40px;
}
</style>

<script>
let step=1;

function next(){
document.getElementById("step"+step).classList.add("hidden");
step++;
document.getElementById("step"+step).classList.remove("hidden");
window.scrollTo(0,0);
}

function back(){
document.getElementById("step"+step).classList.add("hidden");
step--;
document.getElementById("step"+step).classList.remove("hidden");
window.scrollTo(0,0);
}

function runModel(){

let capital=parseFloat(document.getElementById("capital").value)||0;
let income=parseFloat(document.getElementById("income").value)||0;
let pension=parseFloat(document.getElementById("pension").value)||0;
let later=parseFloat(document.getElementById("later").value)||0;
let ret=(parseFloat(document.getElementById("return").value)||5)/100;
let inf=(parseFloat(document.getElementById("inflation").value)||3)/100;
let age=parseInt(document.getElementById("age").value)||67;

let draw1=income-pension;
let draw2=later-pension;

let rate2=(draw2/capital)*100;

let balance=capital;
let balances=[];
let years=0;

for(let i=0;i<40;i++){
let withdrawal=(i<8?draw1:draw2)*Math.pow(1+inf,i);
balance=balance*(1+ret)-withdrawal;
if(balance<=0){balance=0;}
balances.push(balance);
if(balance===0){break;}
years++;
}

let depletionAge=age+years;

let box=document.getElementById("output");

let draw1Formatted=draw1.toLocaleString();
let draw2Formatted=draw2.toLocaleString();

let explanation = `
<b>What this means:</b><br><br>
Your portfolio draw is <b>£${draw1Formatted}</b> per year today 
and <b>£${draw2Formatted}</b> in Phase Two (both inflation-linked).<br><br>
If withdrawals exceed growth, capital erosion accelerates — particularly after the Phase Two step-change.
`;

if(rate2>8){
box.className="result-box red";
box.innerHTML= explanation + `
<br><br><b>Structural mismatch identified.</b><br>
Under these assumptions, capital may deplete around age <b>${depletionAge}</b>.<br><br>
<b>Structured planning may include:</b><br>
• Income floor creation<br>
• Liability matching using ~5% fixed income<br>
• Growth reserve for longevity
`;
}
else if(rate2>4.5){
box.className="result-box orange";
box.innerHTML= explanation + `
<br><br><b>Structural pressure detected.</b><br>
Long-term sustainability may require adjustment.
`;
}
else{
box.className="result-box green";
box.innerHTML= explanation + `
<br><br><b>Structure appears more resilient.</b><br>
Withdrawal rates remain within more sustainable ranges.
`;
}

drawChart(balances,8);
next();
}

function drawChart(data,phaseYear){
let c=document.getElementById("chart");
let ctx=c.getContext("2d");
ctx.clearRect(0,0,c.width,c.height);

let max=Math.max(...data);
let w=c.width;
let h=c.height;

ctx.beginPath();
ctx.moveTo(0,h-(data[0]/max*h));

for(let i=1;i<data.length;i++){
ctx.lineTo(i*(w/data.length),h-(data[i]/max*h));
}

ctx.strokeStyle="#d4af37";
ctx.lineWidth=3;
ctx.stroke();

/* Phase Two marker */
let x=phaseYear*(w/data.length);
ctx.beginPath();
ctx.moveTo(x,0);
ctx.lineTo(x,h);
ctx.strokeStyle="#888";
ctx.stroke();
}
</script>
</head>

<body>

<h1>Structured Retirement Income</h1>
<div class="subtitle">Private wealth boutique diagnostic</div>

<div id="step1">
<div class="card">
<h2>Will Your Retirement Survive Phase Two?</h2>
<p>Most retirement plans assume steady spending.</p>
<p>Few prepare for inflation, longevity, and rising later-life costs.</p>
<button onclick="next()">Begin Diagnostic</button>
</div>
</div>

<div id="step2" class="hidden">
<div class="card">
<h2>Why This Matters</h2>
<p>Inflation, longevity and later-life costs can create structural strain.</p>
<button onclick="next()">Continue</button>
<button class="secondary" onclick="back()">Back</button>
</div>
</div>

<div id="step3" class="hidden">
